<app-navbar></app-navbar>
<ngx-loading [show]="loading"></ngx-loading>

<div class="pagesLog">
  <img src="/assets/imgs/M-Logo.PNG" height="25px">
  <i class="fas fa-chevron-right lightGray px-3"></i>
  <p class="bold my-0">Browse</p>
  <i class="fas fa-chevron-right lightGray px-3"></i>
  <p class="bold my-0">Job Detail</p>
  <i class="fas fa-chevron-right lightGray px-3"></i>
  <p class="bold my-0">{{jobOwner.fullName}}</p>
</div>

<div class="row mainCont">
  <div class="col-sm-12 maxWidthContent">
    <h4 class="mb-0 bold">{{jobDetail.jobTitle}}</h4>
    <div class="card jobDetailCard">
      <div class="d-flex mb-5">
        <div class="userImgCont">
          <img [src]="jobOwner.profileUrl || '/assets/imgs/userIcon.PNG'" class="userImg">
          <!-- <img src="/assets/imgs/chatIcon.svg" class="chatIcon"> -->
        </div>
        <div class="txtCont">
          <div class="d-flex">
            <h4 class="mb-0 bold mr-2">{{jobOwner.fullName}}</h4>
            <img src="/assets/imgs/tickIcon.svg" class="align-center" height="30px">
          </div>
          <p class="mt-1 mb-0 font-14 text1">{{jobOwnerAgency || 'N/A'}}</p>
          <div class="d-flex mt-1">
            <i class="fas fa-map-marker-alt align-center"></i>
            <p class="mb-0 align-center font-14 ml-2">{{jobDetail.preferredLocation}}</p>
            <p class="font-14 text1 ml-1 mb-0 align-center">
              {{jobDetail.timestamp | date: 'mediumDate'}}
            </p>
          </div>
          <button (click)="navigateJobDetail()" class="btn darkBtn mt-3">Project Detail</button>
        </div>
      </div>

      <h5 class="mb-0 bold pt-2">Submit a Bid</h5>
      <div class="row mt-4">
        <div *ngIf="myBidObject.type==='fixed'" class="col-sm-4 pl-0">
          <div class="card payCard active">
            <div class="txt text-center">
              <img src="/assets/imgs/fixedBid.PNG" height="50px">
              <h5 class="mt-4 mb-2 bold font-18">Submit Fixed Bid</h5>
              <p class="font-15 mb-0 fw500">Best for projects with finite scope</p>
            </div>
          </div>
        </div>
        <div *ngIf="myBidObject.type==='milestone'" class="col-sm-4 pr-0">
          <div class="card payCard active">
            <div class="txt text-center">
              <img src="/assets/imgs/milestone.svg">
              <h5 class="mt-4 mb-2 bold font-18">Add Milestone</h5>
              <p class="font-15 mb-0 fw500">Best if there is more work to be done on<br /> this project</p>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-5" *ngIf="myBidObject.type==='fixed'">
        <label>Fixed Price</label>
        <input type="number" min="0" class="form-control" [(ngModel)]="myBidObject.fixedPrice">
      </div>

      <div *ngIf="myBidObject.type==='milestone'">
        <div *ngIf="myBidObject.milestones.length">
          <h5 class="mb-4 bold pt-2 mt-5">All Milestones</h5>
          <div *ngFor="let milestone of myBidObject.milestones; index as i" class="milstone">
            <p class="font-13 bold">
              Milestone {{i+1}} of {{myBidObject.milestones.length}}:
              {{milestone.name}} RM {{milestone.price}}
            </p>
            <button (click)="editMilestone(i)" data-toggle="modal" data-target="#addMilestoneModal"
              class="btn btn-link float-right">Update</button>
            <button (click)="removeMilestone(i)" class="btn btn-link text-danger float-right">Remove</button>
          </div>
        </div>

        <p (click)="newMilestone()" data-toggle="modal" data-target="#addMilestoneModal"
          class="font-14 bold mb-0 mt-3 align-center pl-2 blueTxt pointer">
          <i class="fas fa-plus-circle subTxt align-center"></i>
          Add New Milestone</p>
      </div>

      <div *ngIf="myBidObject.answers && myBidObject.answers.length">
        <h5 class="mb-4 bold pt-2 mt-5">Job Questions</h5>
        <div *ngFor="let question of myBidObject.answers" class="mb-3">
          <label>{{question.question}}</label>
          <input type="text" class="form-control" [(ngModel)]="question.answer">
        </div>
      </div>

      <h5 class="mb-4 bold pt-2 mt-5">Cover Letter</h5>
      <textarea [(ngModel)]="myBidObject.coverLetter" rows="9" class="form-control"
        placeholder="Write here..."></textarea>

      <div class="submitBtnCont">
        <button [disabled]="jobDetail.status==='Closed'" (click)="submitBid()" class="btn darkBtn">Submit Bid</button>
      </div>
    </div>
  </div>
</div>

<app-footer></app-footer>


<div class="modal fade" id="addMilestoneModal">
  <div class="modal-dialog myModal modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header px-4">
        <h4 class="modal-title bold">
          {{isEditMilestone ? 'Update Milestone' : 'Add Milestone'}}
        </h4>
        <i class="fas fa-times align-center pointer text1" data-dismiss="modal" style="font-size: 22px;"></i>
      </div>

      <div class="modal-body px-0 pb-4">
        <form [formGroup]="milestoneForm" (ngSubmit)="saveThisMilestone(milestoneForm.value)">
          <div class="row justify-content-center mt-4">
            <div class="col-sm-11 px-0">
              <div class="form-group">
                <label class="mb-3 bold">Title</label>
                <input formControlName="name" type="text" class="form-control" placeholder="Enter milestone title">
                <p class="errorMsg" *ngIf="milestoneForm.get('name').hasError('required') && 
                  (milestoneForm.get('name').dirty || milestoneForm.get('name').touched)">
                  *This field is required
                </p>
              </div>

              <div class="row">
                <div class="col-md-4 pl-0">
                  <div class="form-group">
                    <label class="mb-3 bold">End Day</label>
                    <ng-select [items]="days" formControlName="endDay"></ng-select>
                    <p class="errorMsg" *ngIf="milestoneForm.get('endDay').hasError('required') && 
                       (milestoneForm.get('endDay').dirty || milestoneForm.get('endDay').touched)">
                      *This field is required
                    </p>
                  </div>
                </div>
                <div class="col-md-4 px-0">
                  <div class="form-group">
                    <label class="mb-3 bold">End Month</label>
                    <ng-select [items]="months" formControlName="endMonth"></ng-select>
                    <p class="errorMsg" *ngIf="milestoneForm.get('endMonth').hasError('required') && 
                      (milestoneForm.get('endMonth').dirty || milestoneForm.get('endMonth').touched)">
                      *This field is required
                    </p>
                  </div>
                </div>
                <div class="col-md-4 pr-0">
                  <div class="form-group">
                    <label class="mb-3 bold">End Year</label>
                    <ng-select [items]="years" formControlName="endYear"></ng-select>
                    <p class="errorMsg" *ngIf="milestoneForm.get('endYear').hasError('required') && 
                      (milestoneForm.get('endYear').dirty || milestoneForm.get('endYear').touched)">
                      *This field is required
                    </p>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <p class="mb-3 bold">Price</p>
                <input min="0" formControlName="price" type="number" class="form-control"
                  placeholder="Enter milestone price">
                <p class="errorMsg" *ngIf="milestoneForm.get('price').hasError('required') && 
                      (milestoneForm.get('price').dirty || milestoneForm.get('price').touched)">
                  *This field is required
                </p>
              </div>

              <div class="text-right mb-2">
                <button id="closeModalButton" class="btn btn-outline-primary" data-dismiss="modal">Cancel</button>
                <button [disabled]="!milestoneForm.valid" type="submit" class="btn darkBtn ml-4">Save</button>
              </div>
            </div>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>